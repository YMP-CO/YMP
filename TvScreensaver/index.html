<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Фото Выбор</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400&display=swap">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <style>
  body {
  margin: 0;
  padding: 0;
  font-family: 'Open Sans', sans-serif;
  background-color: #303030;
  color: white;
  overflow: hidden;
  background-size: cover;
  background-position: center;
}

/* Часы */
#time-container {
  position: absolute;
  bottom: 50px;
  left: 15px;
  font-size: 100px;
  font-weight: 300;
  color: white;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

#time-container .background {
  position: absolute;
  top: 1;
  left: 0;
  width: 100%;
  height: 100px;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 0;
  padding: 20px 20px;
  box-sizing: border-box;
}

#clock {
  position: relative;
  z-index: 1;
}

/* Контейнер для кнопок */
#auth-container {
  position: absolute;
  bottom: 16px;
  right: 16px;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  z-index: 10;
}

/* Основная кнопка (войти и выбрать изображение) */
.mdl-button {
  background-color: #4285f4;
  color: white;
  font-size: 14px;
  text-transform: none;
  border: none;
  border-radius: 4px;
  padding: 0 16px;
  height: 36px;
  min-width: 64px;
  box-shadow: 0 2px 5px 0 rgba(0,0,0,.26);
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}

.mdl-button:hover,
.mdl-button:focus {
  background-color: #357abd;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,.4);
}

.mdl-button:active {
  background-color: #2b60a1;
  box-shadow: 0 1px 3px 0 rgba(0,0,0,.3);
}

/* Кнопка выхода */
.mdl-button.logout {
  background-color: transparent;
  color: rgba(255,255,255,.7);
  font-size: 14px;
  text-transform: none;
  border: 1px solid rgba(255,255,255,.3);
  margin-top: 8px;
  box-shadow: none;
  transition: all 0.2s ease;
}

.mdl-button.logout:hover,
.mdl-button.logout:focus {
  background-color: rgba(255,255,255,.1);
  border-color: rgba(255,255,255,.5);
  color: rgba(255,255,255,.9);
}

.mdl-button.logout:active {
  background-color: rgba(255,255,255,.2);
}

/* Ripple эффект */
.mdl-button::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: rgba(255,255,255,.5);
  opacity: 0;
  border-radius: 100%;
  transform: scale(1, 1) translate(-50%);
  transform-origin: 50% 50%;
}

.mdl-button:focus:not(:active)::after {
  animation: ripple 1s ease-out;
}

/* Окно выбора фотографии */
#photo-dialog {
  position: fixed;
  bottom: 0;
  right: 0;
  width: 400px;
  height: 600px;
  background-color: #424242;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  display: none;
  flex-direction: column;
  padding: 16px;
  z-index: 20;
  transform: translateY(100%);
  transition: transform 0.3s ease-in-out;
}

#photo-dialog.active {
  display: flex;
  transform: translateY(0);
}

#photo-dialog .title {
  font-size: 18px;
  margin-bottom: 16px;
  color: white;
}

.photo-grid {
  flex-grow: 1;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: auto;
  gap: 8px;
  overflow-y: auto;
  padding-bottom: 16px;
}

.photo-item {
  position: relative;
  cursor: pointer;
  border-radius: 4px;
  overflow: hidden;
  width: 100%;
  height: 0;
  padding-bottom: 100%;
  transition: transform 0.2s;
}

.photo-item img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.photo-item.selected {
  outline: 3px solid #4285f4;
  background-color: #4285f4;
}

.photo-item:hover {
  transform: scale(1.05);
}

/* Кнопка закрытия */
#close-button {
  background-color: #303030;
  position: absolute;
  top: 8px;
  right: 8px;
  cursor: pointer;
  font-size: 20px;
  color: white;
  border: none;
  outline: none;
  padding: 8px;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease;
}

#close-button:hover,
#close-button:focus {
  background-color: #404040;
}

#close-button:active {
  background-color: #505050;
}

/* Стилизация скроллбара */
.photo-grid::-webkit-scrollbar {
  width: 8px;
}

.photo-grid::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
}

.photo-grid::-webkit-scrollbar-thumb:hover {
  background: #555;
}

/* Анимация Ripple */
@keyframes ripple {
  0% {
    transform: scale(0, 0);
    opacity: 1;
  }
  20% {
    transform: scale(25, 25);
    opacity: 1;
  }
  100% {
    opacity: 0;
    transform: scale(40, 40);
  }

}
      </style>
</head>

<body>
  <!-- Часы -->
  <div id="time-container">
    <div class="background"></div>
    <div id="clock"></div>
  </div>

  <!-- Кнопки авторизации, выбора и выхода -->
  <div id="auth-container">
    <button id="auth-button" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
      Войти через Google
    </button>
    <button id="choose-photo-button" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" style="display: none;">
      Выбрать изображение
    </button>
    <button id="logout-button" class="mdl-button logout mdl-js-button mdl-js-ripple-effect" style="display: none;">
      Выйти из аккаунта
    </button>
  </div>

  <!-- Окно выбора фотографии -->
  <div id="photo-dialog">
    <button id="close-button" title="Закрыть">×</button>
    <div class="title">Выберите изображение из Google Фото:</div>
    <div class="photo-grid" id="photo-grid"></div>
  </div>
  <script>
 const CLIENT_ID = '666120907144-uqjrqt97dja11m8qki68o83s0lt6j50k.apps.googleusercontent.com';
const REDIRECT_URI = 'https://ymp-co.github.io/TvScreensaver/index.html';
const SCOPE = 'https://www.googleapis.com/auth/photoslibrary.readonly';
const AUTH_URL = 'https://accounts.google.com/o/oauth2/v2/auth';

let accessToken = null;
let photos = [];
let selectedIndex = 0;
let focusedElement = null;
const focusableElements = ['auth-button', 'choose-photo-button', 'logout-button'];

// Обновление времени
function updateTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('ru-RU', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    document.getElementById('clock').textContent = timeString;
}

setInterval(updateTime, 1000);
updateTime();

// Открыть окно авторизации
function openAuth() {
    const authUrl = `${AUTH_URL}?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=token&scope=${SCOPE}`;
    window.location.href = authUrl;
}

// Получить access_token из URL
function getAccessToken() {
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    return params.get('access_token');
}

// Получить фотографии
async function fetchPhotos() {
    const response = await fetch('https://photoslibrary.googleapis.com/v1/mediaItems', {
        headers: {
            'Authorization': `Bearer ${accessToken}`
        }
    });
    const data = await response.json();
    return data.mediaItems || [];
}

// Рендер фотографий
function renderPhotos() {
    const photoGrid = document.getElementById('photo-grid');
    photoGrid.innerHTML = '';

    photos.forEach((photo, index) => {
        const photoItem = document.createElement('div');
        photoItem.classList.add('photo-item');

        const img = document.createElement('img');
        img.src = `${photo.baseUrl}=w300-h300-c`;
        img.alt = photo.filename || `Фото ${index + 1}`;

        photoItem.appendChild(img);
        photoItem.addEventListener('click', () => {
            selectPhoto(index, photo.baseUrl);
        });

        photoGrid.appendChild(photoItem);
    });
}

// Выбор фото
function selectPhoto(index, baseUrl) {
    selectedIndex = index;
    const highResolutionUrl = `${baseUrl}=d`;
    document.body.style.backgroundImage = `url(${highResolutionUrl})`;
    localStorage.setItem('backgroundImage', highResolutionUrl);
    closePhotoDialog();
}

// Функция для управления фокусом
function handleGlobalNavigation(event) {
    const visibleButtons = focusableElements
        .map(id => document.getElementById(id))
        .filter(element => element && element.style.display !== 'none');

    if (!visibleButtons.length) return;

    if (!focusedElement) {
        focusedElement = visibleButtons[0];
        focusedElement.focus();
        return;
    }

    const currentIndex = visibleButtons.indexOf(focusedElement);

    switch (event.key) {
        case 'ArrowUp':
        case 'Up':
            event.preventDefault();
            const prevIndex = (currentIndex - 1 + visibleButtons.length) % visibleButtons.length;
            focusedElement = visibleButtons[prevIndex];
            break;

        case 'ArrowDown':
        case 'Down':
            event.preventDefault();
            const nextIndex = (currentIndex + 1) % visibleButtons.length;
            focusedElement = visibleButtons[nextIndex];
            break;

        case 'Enter':
        case 'Return':
            event.preventDefault();
            focusedElement.click();
            break;
    }

    focusedElement.focus();
}

// Открыть диалог выбора фото
function openPhotoDialog() {
    const dialog = document.getElementById('photo-dialog');
    dialog.style.display = 'flex';
    setTimeout(() => dialog.classList.add('active'), 10);
}

// Закрыть диалог выбора фото
function closePhotoDialog() {
    const dialog = document.getElementById('photo-dialog');
    dialog.classList.remove('active');
    setTimeout(() => {
        dialog.style.display = 'none';
    }, 300);
    document.getElementById('choose-photo-button').focus();
}

// Выйти из аккаунта
function logout() {
    localStorage.clear();
    accessToken = null;
    window.location.href = window.location.pathname;
}

// Загрузка сохраненного фона
function loadCachedBackground() {
    const cachedBackground = localStorage.getItem('backgroundImage');
    if (cachedBackground) {
        document.body.style.backgroundImage = `url(${cachedBackground})`;
    }
}

// Инициализация
async function init() {
    loadCachedBackground();
    accessToken = getAccessToken();

    if (!accessToken) {
        document.getElementById('auth-button').style.display = 'block';
        document.getElementById('choose-photo-button').style.display = 'none';
        document.getElementById('logout-button').style.display = 'none';
    } else {
        document.getElementById('auth-button').style.display = 'none';
        document.getElementById('choose-photo-button').style.display = 'block';
        document.getElementById('logout-button').style.display = 'block';
        try {
            photos = await fetchPhotos();
            renderPhotos();
        } catch (error) {
            console.error('Ошибка загрузки фотографий:', error);
        }
    }

    // Добавляем обработчик глобальной навигации
    document.addEventListener('keydown', handleGlobalNavigation);
}

// Обработчики событий
document.getElementById('auth-button').addEventListener('click', openAuth);
document.getElementById('choose-photo-button').addEventListener('click', openPhotoDialog);
document.getElementById('close-button').addEventListener('click', closePhotoDialog);
document.getElementById('logout-button').addEventListener('click', logout);

// Запуск приложения
init();
  </script>
</body>

</html>
