<!DOCTYPE html>
<html>
<head>
  <title>Вход через Google и список фотографий Google Фото</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <h1>Вход через Google и список фотографий Google Фото</h1>

  <!-- Кнопка для входа через Google -->
  <div id="google-login-button"></div>

  <!-- Контейнер для отображения списка фотографий -->
  <div id="photo-list"></div>
<script src="https://apis.google.com/js/platform.js?onload=onLoadCallback" async defer></script>
<script>
window.onLoadCallback = function(){
  gapi.auth2.init({
      client_id: '666120907144-uqjrqt97dja11m8qki68o83s0lt6j50k.apps.googleusercontent.com'
    });
}
</script>
  <script>
    // Инициализация Google Sign-In
    function initGoogleSignIn() {
      google.accounts.id.initialize({
        client_id: '666120907144-uqjrqt97dja11m8qki68o83s0lt6j50k.apps.googleusercontent.com',
        callback: handleGoogleSignIn
      });
      google.accounts.id.prompt();
    }

    // Обработка успешного входа через Google
    function handleGoogleSignIn(response) {
      if (response.credential) {
        // Вход успешен, получение доступа к Google Photos Library API
        gapi.load('client:auth2', initGooglePhotosAPI);
      } else {
        // Вход не удался
        console.log('Вход не удался');
      }
    }

    // Инициализация Google Photos Library API
    function initGooglePhotosAPI() {
      gapi.client.init({
        apiKey: 'AIzaSyAocyYlBmQmguCP7zEsqMmzHrqhig-aRX0',
        clientId: '666120907144-uqjrqt97dja11m8qki68o83s0lt6j50k.apps.googleusercontent.com',
        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/photoslibrary/v1/rest'],
        scope: 'https://www.googleapis.com/auth/photoslibrary.readonly'
      }).then(function() {
        // Аутентификация пользователя
        return gapi.auth2.getAuthInstance().signIn();
      }).then(function() {
        // Пользователь аутентифицирован, получение списка фотографий
        return gapi.client.photoslibrary.mediaItems.list({
          pageSize: 10
        });
      }).then(function(response) {
        // Обработка списка фотографий
        var photos = response.result.mediaItems;
        if (photos && photos.length > 0) {
          var photoListContainer = document.getElementById('photo-list');
          var photoListHTML = '<h2>Список фотографий</h2><ul>';
          photos.forEach(function(photo) {
            var photoUrl = photo.baseUrl;
            var photoTitle = photo.filename;
            photoListHTML += '<li><img src="' + photoUrl + '" alt="' + photoTitle + '"></li>';
          });
          photoListHTML += '</ul>';
          photoListContainer.innerHTML = photoListHTML;
        } else {
          console.log('Нет доступных фотографий');
        }
      }, function(error) {
        console.log('Произошла ошибка', error);
      });
    }

    // Загрузка Google Sign-In и инициализация после загрузки
    window.addEventListener('load', function() {
      initGoogleSignIn();
    });
  </script>
</body>
</html>
