<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Photos Auth</title>
</head>
<body>
  <h1>Авторизация через Google</h1>
  <button id="login-button">Войти через Google</button>

  <div id="photos-container"></div>

  <script>
    const CLIENT_ID = '666120907144-uqjrqt97dja11m8qki68o83s0lt6j50k.apps.googleusercontent.com';
    const REDIRECT_URI = 'https://ymp-co.github.io'; // Укажите редирект URI, тот же, что вы настроили в Google Console
    const SCOPE = 'https://www.googleapis.com/auth/photoslibrary.readonly';
    const AUTH_URL = 'https://accounts.google.com/o/oauth2/v2/auth';

    const loginButton = document.getElementById('login-button');
    loginButton.addEventListener('click', () => {
      const authUrl = `${AUTH_URL}?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=token&scope=${SCOPE}`;
      window.location.href = authUrl;
    });

    // Функция для получения токена доступа из URL после редиректа
    function getAccessTokenFromUrl() {
      const urlParams = new URLSearchParams(window.location.hash.substring(1));
      return urlParams.get('access_token');
    }

    // Функция для получения фотографий с Google Photos
    async function getPhotos(accessToken) {
      const response = await fetch('https://photoslibrary.googleapis.com/v1/mediaItems', {
        headers: {
          Authorization: `Bearer ${accessToken}`,
        },
      });
      const data = await response.json();
      return data.mediaItems || [];
    }

    // Отобразить фотографии
    function displayPhotos(photos) {
      const container = document.getElementById('photos-container');
      photos.forEach(photo => {
        const img = document.createElement('img');
        img.src = photo.baseUrl;
        img.alt = photo.filename;
        container.appendChild(img);
      });
    }

    // Проверяем наличие токена доступа и загружаем фотографии
    const accessToken = getAccessTokenFromUrl();
    if (accessToken) {
      getPhotos(accessToken).then(displayPhotos);
    }
  </script>
</body>
</html>
